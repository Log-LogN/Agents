import sys
import os

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "../../../")))

from mcp.server.fastmcp import FastMCP
from agents.vulnerability.mcp_server.tools.cve_search import cve_search
from agents.vulnerability.mcp_server.tools.service_lookup import service_cve_lookup

mcp = FastMCP("vulnerability-mcp")


@mcp.tool()
def tool_cve_search(keyword: str):
    """
    Search public CVE database (NVD) by keyword.
    Used for vulnerability intelligence and defensive security analysis.
    """
    return cve_search(keyword)


@mcp.tool()
def tool_service_cve(product: str, version: str):
    """
    Lookup vulnerabilities for a specific product version.
    Example: product='apache', version='2.4.49'
    """
    return service_cve_lookup(product, version)


if __name__ == "__main__":
    mcp.run(transport="stdio")